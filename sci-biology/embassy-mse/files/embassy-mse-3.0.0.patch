diff --git a/Makefile.am b/Makefile.am
index 3e3dcb3..6fcfdc0 100644
--- a/Makefile.am
+++ b/Makefile.am
@@ -1,5 +1,6 @@
 #
 
+ACLOCAL_AMFLAGS = -I m4
 SUBDIRS = ckit src h emboss_acd emboss_doc
 
 EXTRA_DIST = LICENSE depcomp ltmain.sh install-sh config.sub config.guess
diff --git a/ckit/datafiles.c b/ckit/datafiles.c
index d9e0f11..4ef70a4 100644
--- a/ckit/datafiles.c
+++ b/ckit/datafiles.c
@@ -211,7 +211,7 @@ void ShowGCGEnzymes(char *enzFName,Boolean doSchiz,int *where)
 #define PERLINE 8
 #define PERSCREEN 21
 
-char line[256];
+char line[512];
 int i,j;
 
 char *cPos;
diff --git a/ckit/gcg.c b/ckit/gcg.c
index a1e63a6..c6347f1 100644
--- a/ckit/gcg.c
+++ b/ckit/gcg.c
@@ -165,7 +165,7 @@ char errMsg[80];
 static char *NextGCGCode(void)
 {
 static Boolean initialized = 0;
-static char code[20];
+static char code[64];
 
 	if (!initialized) {
 	  initialized = 1;
diff --git a/ckit/readentry.c b/ckit/readentry.c
index a01b1c0..86fae27 100644
--- a/ckit/readentry.c
+++ b/ckit/readentry.c
@@ -343,7 +343,7 @@ static Boolean FindSeqSpec( SeqSpec *spec, SeqEntry *seq)
 {
 char line[512];
 static char name[256] = "";
-static char title[256] = "";
+static char title[512] = "";
 char errMsg[80];
 char *cPos;
 
diff --git a/configure.in b/configure.in
index 445e48b..d48c1b8 100644
--- a/configure.in
+++ b/configure.in
@@ -187,15 +187,6 @@ AC_PROG_INSTALL
 AC_PROG_LN_S
 AC_PROG_MAKE_SET
 
-dnl Intel MacOSX 10.6 puts X11 in a non-standard place
-if test "${with_x}" != "no" ; then
-if test "`uname -a | grep Darwin`"; then
-OSXX=`sw_vers -productVersion | sed 's/\(10\.[[0-9]]*\).*/\1/'`
-if test ${OSXX} '>' '10.4'; then
-CFLAGS="$CFLAGS -I/usr/X11/include -L/usr/X11/lib"
-fi
-fi
-fi
 
 dnl Check for header files
 AC_PATH_XTRA
@@ -250,8 +241,8 @@ AX_LIB_POSTGRESQL
 CFLAGS="$CFLAGS $MYSQL_CFLAGS"
 LDFLAGS="$LDFLAGS $MYSQL_LDFLAGS"
 
-CFLAGS="$CFLAGS $POSTGRESQL_CFLAGS"
-LDFLAGS="$LDFLAGS $POSTGRESQL_LDFLAGS"
+CFLAGS="$POSTGRESQL_CFLAGS $CFLAGS"
+LDFLAGS="$POSTGRESQL_LDFLAGS $LDFLAGS"
 
 
 dnl "Export" these variables for PCRE
@@ -388,9 +379,30 @@ AC_ARG_ENABLE(systemlibs,
    AS_HELP_STRING([--enable-systemlibs], [Use system versions of zlib/expat]))
 if test "${enable_systemlibs}" = "yes" ; then
     have_systemlibs=yes
+    DEFINE_USE_SYSTEM_PCRE="#define"
+    PKG_CHECK_MODULES([PLPLOT], [plplotd])
+    PKG_CHECK_MODULES([ZLIB], [zlib])
+else
+    dnl X11 is only used by plplot
+    dnl Intel MacOSX 10.6 puts X11 in a non-standard place
+    if test "${with_x}" != "no" ; then
+    if test "`uname -a | grep Darwin`"; then
+    OSXX=`sw_vers -productVersion | sed 's/\(10\.[[0-9]]*\).*/\1/'`
+    if test ${OSXX} '>' '10.4'; then
+    CFLAGS="$CFLAGS -I/usr/X11/include -L/usr/X11/lib"
+    fi
+    fi
+    fi
+    if test "${with_x}" != "no" ; then
+    LF_EMBOSS_PATH_XLIB
+    fi
+     AC_MSG_NOTICE(USING bundled LIBS)
 fi          
 AM_CONDITIONAL(ESYSTEMLIBS, test "$have_systemlibs" = "yes")
 AC_SUBST(ESYSTEMLIBS)
+AC_SUBST(DEFINE_USE_SYSTEM_PCRE)
+AC_SUBST(PLPLOT_CFLAGS)
+AC_SUBST(PLPLOT_LIBS)
 
 
 
diff --git a/src/Makefile.am b/src/Makefile.am
index f52d4ec..a3c08ef 100644
--- a/src/Makefile.am
+++ b/src/Makefile.am
@@ -18,9 +18,9 @@ INCLUDES = -I../h \
 	-I../../../ajax/ensembl -I../../../ajax/ajaxdb \
 	-I../../../ajax/acd -I../../../plplot
 else
-INCLUDES = -I../h -I${embprefix}/include \
-	-I${embprefix}/include/eplplot -I${embprefix}/include/epcre \
-	$(NLINCLUDES)
+INCLUDES = -I../h -I${embprefix}/include $(PLPLOT_CFLAGS) \
+	$(NLINCLUDES) -I${embprefix}/include/emboss \
+	-I${embprefix}/include/pcre
 endif
 
 if ISSHARED
@@ -59,6 +59,6 @@ LDADD = ../ckit/libckit.la \
 	../../../plplot/libeplplot.la \
 	$(XLIB)
 else
-LDADD = ../ckit/libckit.la -L${embprefix}/lib -lnucleus -lacd -lajaxdb \
-	-lensembl -lajaxg -lajax -lepcre $(NLADD) -leplplot $(XLIB)
+LDADD = ../ckit/libckit.la -lnucleus -lacd -lajaxdb -lensembl -lajaxg \
+        -lajax -lpcre $(NLADD) $(PLPLOT_LIBS) $(XLIB)
 endif
